---
title : 各种直播流协议详解
date: 2021-07-22
tags: ["livestream","web media"]
---

<!--more-->

## hls
safari的h5原生支持hls(m3u8)播放
chrome等浏览器需要自己写解码

移动端和Safari可直接支持m3u8
支持H.264、H.265视频编码和AAC音频编码?
播放器直播流全平台支持flv，hls直播协议，支持解h264、h265解码。


| 协议      | 延迟 |         谁在用 | 原理|优缺点|
| :----- | :--: | :-----------: | :-----------: |-----------: |
| HttpFlv     |  低 1~3秒  |     斗鱼 pc web | 
| RTMP   |  低 1~3秒  |   - |转发|
| HLS |  高 5~20秒（依切片情况）  | 各种移动web端 |切片|性能高，延迟高| 
| DASH/MPEG-DASH |  高  | 油管，奈飞 |切片|

HLS 是苹果的 全系列兼容

DASH 和他很相似 iOS 不兼容

都支持 4K

FFmpeg 可以生成这两种不同协议的流
## DASH协议 
主播直播流上传

服务器的编解码封装
流媒体分发器
    mpd文件
    切割后的媒体文件
客户端
    客户端加载mpd文件
    解析MPD文件, 组成文件下载链接
    当前的网速和支持的编码加载相应的视频片段进行播放

### 前端工作：

加载视频说明mpd文件
识别mpd内容
判断网速加载第一个适合该网速的视频片段, 解析视频数据
视频数据通过 MSE(Media Source Extensions) API 把视频数据传输给Video播放
不断通过加载视频片段大小/下载时间得出网速, 下载相应码率的视频

http://ivi.bupt.edu.cn/hls/cctv6hd.m3u8
